{
    "type": "object",
    "properties":{
        "general":{"$ref": "#/definitions/General"},
        "ngen": {"$ref": "#/definitions/NGen"}
    },
    "definitions": {
        "NGen":{
            "title": "Ngen",
            "description": "Ngen configuration requirements",
            "type":"object",
            "descriminator": "strategy",
            "default": {"$ref": "#/definitions/NgenIndependent"},
            "anyOf": [
                {
                    "$ref": "#/definitions/NgenIndependent",
                    "title": "Independent"
                },
                {
                    "$ref": "#/definitions/NgenExplicit",
                    "title": "Explicit"
                },
                {
                    "$ref": "#/definitions/NgenUniform",
                    "title": "Uniform"
                }
            ]
        },
        "General":{
            "title": "General",
            "description": "General ngen-cal configuration requirements",
            "type": "object",
            "properties": {
              "strategy": {
                "title": "Strategy",
                "discriminator": {
                  "propertyName": "type",
                  "mapping": {
                    "estimation": "#/definitions/Estimation",
                    "sensitivity": "#/definitions/Sensitivity"
                  }
                },
                "anyOf": [
                  {
                    "$ref": "#/definitions/Estimation",
                    "title": "Estimation"
                  },
                  {
                    "$ref": "#/definitions/Sensitivity",
                    "title": "Sensitivity"
                  }
                ]
              },
              "iterations": {
                "title": "Iterations",
                "type": "integer"
              },
              "evaluation_start": {
                "title": "Evaluation Start",
                "type": "string",
                "format": "date-time"
              },
              "evaluation_stop": {
                "title": "Evaluation Stop",
                "type": "string",
                "format": "date-time"
              },
              "name": {
                "title": "Name",
                "default": "ngen-calibration",
                "type": "string"
              },
              "random_seed": {
                "title": "Random Seed",
                "type": "integer"
              }
            },
            "required": [
              "strategy",
              "iterations"
            ]
        },
        "Algorithm": {
            "title": "Algorithm",
            "description": "Enumeration of supported search algorithms\n\n    ",
            "enum": [
            "dds"
            ],
            "type": "string",
            "default":"dds"
        },
        "Objective": {
            "title": "Objective",
            "description": "Enumeration of supported search algorithms\n\n    ",
            "enum": [
            "custom",
            "kling_gupta",
            "nnse",
            "single_peak",
            "volume"
            ],
            "type":"string",
            "default": "custom"
        },
        "Estimation": {
            "title": "Estimation",
            "description": "Estimation strategy for defining parameter estimation",
            "type": "object",
            "properties": {
            "type": {
                "const": "estimation",
                "default": "estimation"
            },
            "algorithm": {
                "$ref": "#/definitions/Algorithm"
            },
            "objective": {
                "title": "Objective",
                "default": "custom",
                
                    "$ref": "#/definitions/Objective"
                
                
            },
            "target": {
                "title": "Target",
                "default": "min",
                "oneOf": [
                {
                    "enum": [
                    "min",
                    "max"
                    ],
                    "default":"min",
                    "type": "string",
                    "title":"Min/Max"
                },
                {
                    "type": "number",
                    "title": "Value",
                    "default":0
                }
                ]
            }
            },
            "required": [
            
            ]
        },
        "Sensitivity": {
            "title": "Sensitivity",
            "description": "Sensitivity strategy for defining a sensitivity analysis\n\nNOT IMPLEMENTED",
            "type": "object",
            "properties": {
            "type": {
                "const":"sensitivity",
                "default":"sensitivity"
            }
            },
            "required": [
            "type"
            ]
        },
        "TopmodParams": {
            "title": "TopmodParams",
            "description": "Class for validating Topmod Parameters\n    ",
            "type": "object",
            "properties": {
                "sr0": {
                    "title": "Sr0",
                    "type": "number"
                },
                "srmax": {
                    "title": "Srmax",
                    "type": "number"
                },
                "szm": {
                    "title": "Szm",
                    "type": "number"
                },
                "t0": {
                    "title": "T0",
                    "type": "number"
                },
                "td": {
                    "title": "Td",
                    "type": "number"
                }
            }
        },
        "Topmod": {
            "title": "Topmod",
            "description": "A BMIC implementation for the Topmod ngen module\n    ",
            "type": "object",
            "properties": {
                "name": {
                    "title": "Name",
                    "const": "bmi_c",
                    "type": "string"
                },
                "model_type_name": {
                    "title": "Model Type Name",
                    "const": "TOPMODEL",
                    "type": "string"
                },
                "main_output_variable": {
                    "title": "Main Output Variable",
                    "default": "Qout",
                    "type": "string"
                },
                "init_config": {
                    "title": "Init Config",
                    "anyOf": [
                        {
                            "type": "string",
                            "format": "file-path"
                        },
                        {
                            "type": "string"
                        }
                    ]
                },
                "allow_exceed_end_time": {
                    "title": "Allow Exceed End Time",
                    "default": false,
                    "type": "boolean"
                },
                "fixed_time_step": {
                    "title": "Fixed Time Step",
                    "default": false,
                    "type": "boolean"
                },
                "uses_forcing_file": {
                    "title": "Uses Forcing File",
                    "default": false,
                    "type": "boolean"
                },
                "variables_names_map": {
                    "title": "Variables Names Map",
                    "default": {},
                    "type": "object",
                    "additionalProperties": {
                        "type": "string"
                    }
                },
                "output_variables": {
                    "title": "Output Variables",
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                },
                "output_headers": {
                    "title": "Output Headers",
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                },
                "model_params": {
                    "$ref": "#/definitions/TopmodParams"
                },
                "library_file": {
                    "title": "Library File",
                    "anyOf": [
                        {
                            "type": "string",
                            "format": "file-path"
                        },
                        {
                            "type": "string"
                        }
                    ]
                },
                "registration_function": {
                    "title": "Registration Function",
                    "default": "register_bmi_topmodel",
                    "type": "string"
                }
            },
            "required": [
                "init_config",
                "library_file"
            ]
        },
        "CFEParams": {
            "title": "CFEParams",
            "description": "Class for validating CFE Parameters\n    ",
            "type": "object",
            "properties": {
                "maxsmc": {
                    "title": "Maxsmc",
                    "type": "number"
                },
                "satdk": {
                    "title": "Satdk",
                    "type": "number"
                },
                "slope": {
                    "title": "Slope",
                    "type": "number"
                },
                "bb": {
                    "title": "Bb",
                    "type": "number"
                },
                "multiplier": {
                    "title": "Multiplier",
                    "type": "number"
                },
                "expon": {
                    "title": "Expon",
                    "type": "number"
                }
            }
        },
        "CFE": {
            "title": "CFE",
            "description": "A BMIC implementation for the CFE ngen module\n    ",
            "type": "object",
            "properties": {
                "name": {
                    "title": "Name",
                    "const": "bmi_c",
                    "type": "string"
                },
                "model_type_name": {
                    "title": "Model Type Name",
                    "const": "CFE",
                    "type": "string"
                },
                "main_output_variable": {
                    "title": "Main Output Variable",
                    "default": "Q_OUT",
                    "type": "string"
                },
                "init_config": {
                    "title": "Init Config",
                    "anyOf": [
                        {
                            "type": "string",
                            "format": "file-path"
                        },
                        {
                            "type": "string"
                        }
                    ]
                },
                "allow_exceed_end_time": {
                    "title": "Allow Exceed End Time",
                    "default": false,
                    "type": "boolean"
                },
                "fixed_time_step": {
                    "title": "Fixed Time Step",
                    "default": false,
                    "type": "boolean"
                },
                "uses_forcing_file": {
                    "title": "Uses Forcing File",
                    "default": false,
                    "type": "boolean"
                },
                "variables_names_map": {
                    "title": "Variables Names Map",
                    "default": {},
                    "type": "object",
                    "additionalProperties": {
                        "type": "string"
                    }
                },
                "output_variables": {
                    "title": "Output Variables",
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                },
                "output_headers": {
                    "title": "Output Headers",
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                },
                "model_params": {
                    "$ref": "#/definitions/CFEParams"
                },
                "library_file": {
                    "title": "Library File",
                    "anyOf": [
                        {
                            "type": "string",
                            "format": "file-path"
                        },
                        {
                            "type": "string"
                        }
                    ]
                },
                "registration_function": {
                    "title": "Registration Function",
                    "default": "register_bmi_cfe",
                    "type": "string"
                }
            },
            "required": [
                "init_config",
                "library_file"
            ]
        },
        "NoahOWPParams": {
            "title": "NoahOWPParams",
            "description": "Class for validating NoahOWP Parameters\n    ",
            "type": "object",
            "properties": {}
        },
        "NoahOWP": {
            "title": "NoahOWP",
            "description": "A BMIFortran implementation for a noahowp module\n    ",
            "type": "object",
            "properties": {
                "name": {
                    "title": "Name",
                    "const": "bmi_fortran",
                    "type": "string"
                },
                "model_type_name": {
                    "title": "Model Type Name",
                    "const": "NoahOWP",
                    "type": "string"
                },
                "main_output_variable": {
                    "title": "Main Output Variable",
                    "default": "QINSUR",
                    "type": "string"
                },
                "init_config": {
                    "title": "Init Config",
                    "anyOf": [
                        {
                            "type": "string",
                            "format": "file-path"
                        },
                        {
                            "type": "string"
                        }
                    ]
                },
                "allow_exceed_end_time": {
                    "title": "Allow Exceed End Time",
                    "default": false,
                    "type": "boolean"
                },
                "fixed_time_step": {
                    "title": "Fixed Time Step",
                    "default": false,
                    "type": "boolean"
                },
                "uses_forcing_file": {
                    "title": "Uses Forcing File",
                    "default": false,
                    "type": "boolean"
                },
                "variables_names_map": {
                    "title": "Variables Names Map",
                    "default": {},
                    "type": "object",
                    "additionalProperties": {
                        "type": "string"
                    }
                },
                "output_variables": {
                    "title": "Output Variables",
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                },
                "output_headers": {
                    "title": "Output Headers",
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                },
                "model_params": {
                    "$ref": "#/definitions/NoahOWPParams"
                },
                "library_file": {
                    "title": "Library File",
                    "anyOf": [
                        {
                            "type": "string",
                            "format": "file-path"
                        },
                        {
                            "type": "string"
                        }
                    ]
                }
            },
            "required": [
                "init_config",
                "library_file"
            ]
        },
        "LSTM": {
            "title": "LSTM",
            "description": "A BMIPython implementation for an ngen LSTM module\n    ",
            "type": "object",
            "properties": {
                "name": {
                    "title": "Name",
                    "const": "bmi_python",
                    "type": "string"
                },
                "model_type_name": {
                    "title": "Model Type Name",
                    "default": "LSTM",
                    "type": "string"
                },
                "main_output_variable": {
                    "title": "Main Output Variable",
                    "default": "land_surface_water__runoff_depth",
                    "enum": [
                        "land_surface_water__runoff_depth"
                    ],
                    "type": "string"
                },
                "init_config": {
                    "title": "Init Config",
                    "anyOf": [
                        {
                            "type": "string",
                            "format": "file-path"
                        },
                        {
                            "type": "string"
                        }
                    ]
                },
                "allow_exceed_end_time": {
                    "title": "Allow Exceed End Time",
                    "default": false,
                    "type": "boolean"
                },
                "fixed_time_step": {
                    "title": "Fixed Time Step",
                    "default": false,
                    "type": "boolean"
                },
                "uses_forcing_file": {
                    "title": "Uses Forcing File",
                    "default": false,
                    "type": "boolean"
                },
                "variables_names_map": {
                    "title": "Variables Names Map",
                    "default": {},
                    "type": "object",
                    "additionalProperties": {
                        "type": "string"
                    }
                },
                "output_variables": {
                    "title": "Output Variables",
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                },
                "output_headers": {
                    "title": "Output Headers",
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                },
                "model_params": {
                    "title": "Model Params",
                    "type": "object",
                    "additionalProperties": {
                        "type": "string"
                    }
                },
                "python_type": {
                    "title": "Python Type",
                    "default": "bmi_lstm.bmi_LSTM",
                    "anyOf": [
                        {
                            "type": "string"
                        },
                        {
                            "type": "string"
                        }
                    ]
                }
            },
            "required": [
                "init_config"
            ]
        },
        "MultiBMI": {
            "title": "MultiBMI",
            "description": "A MultiBMI model definition\nImplements and overrids several BMIParams attributes,\nand includes a recursive Formulation list `modules`",
            "type": "object",
            "properties": {
                "name": {
                    "title": "Name",
                    "const": "bmi_multi",
                    "type": "string"
                },
                "model_type_name": {
                    "title": "Model Type Name",
                    "type": "string"
                },
                "main_output_variable": {
                    "title": "Main Output Variable",
                    "type": "string"
                },
                "init_config": {
                    "title": "Init Config",
                    "const": "",
                    "type": "string"
                },
                "allow_exceed_end_time": {
                    "title": "Allow Exceed End Time",
                    "default": false,
                    "type": "boolean"
                },
                "fixed_time_step": {
                    "title": "Fixed Time Step",
                    "default": false,
                    "type": "boolean"
                },
                "uses_forcing_file": {
                    "title": "Uses Forcing File",
                    "default": false,
                    "type": "boolean"
                },
                "name_map": {
                    "title": "Name Map",
                    "const": null,
                    "type": "object",
                    "additionalProperties": {
                        "type": "string"
                    }
                },
                "output_variables": {
                    "title": "Output Variables",
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                },
                "output_headers": {
                    "title": "Output Headers",
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                },
                "model_params": {
                    "title": "Model Params",
                    "const": null,
                    "type": "object",
                    "additionalProperties": {
                        "type": "string"
                    }
                },
                "modules": {
                    "title": "Modules",
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/Formulation"
                    }
                }
            },
            "required": [
                "modules"
            ]
        },
        "Formulation": {
            "title": "Formulation",
            "description": "Model of an ngen formulation\n    ",
            "type": "object",
            "properties": {
                "name": {
                    "title": "Name",
                    "type": "string"
                },
                "params": {
                    "title": "Params",
                    "descriminator": "model_name",
                    "anyOf": [
                        {
                            "$ref": "#/definitions/Topmod"
                        },
                        {
                            "$ref": "#/definitions/CFE"
                        },
                        {
                            "$ref": "#/definitions/NoahOWP"
                        },
                        {
                            "$ref": "#/definitions/LSTM"
                        },
                        {
                            "$ref": "#/definitions/MultiBMI"
                        }
                    ]
                }
            },
            "required": [
                "name",
                "params"
            ]
        },
        "Provider": {
            "title": "Provider",
            "description": "Enumeration of the supported NGEN forcing provider strings\n        ",
            "enum": [
                "CsvPerFeature",
                "FIXME"
            ],
            "type": "string"
        },
        "Forcing": {
            "title": "Forcing",
            "description": "Model for ngen forcing component inputs\n    ",
            "type": "object",
            "properties": {
                "file_pattern": {
                    "title": "File Pattern",
                    
                            "type": "string",
                            "format": "file-path"
                        
                    
                },
                "path": {
                    "title": "Path",
                    "type": "string"
                },
                "provider": {
                    "$ref": "#/definitions/Provider"
                }
            },
            "required": [
                "path"
            ]
        },
        "Realization": {
            "title": "Realization",
            "description": "Simple model of a Realization, containing formulations and forcing\n    ",
            "type": "object",
            "properties": {
                "formulations": {
                    "title": "Formulations",
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/Formulation"
                    }
                },
                "forcing": {
                    "$ref": "#/definitions/Forcing"
                },
                "calibration": {
                    "title": "Calibration",
                    "type": "object",
                    "additionalProperties": {
                        "type": "array",
                        "items": {}
                    }
                }
            },
            "required": [
                "formulations",
                "forcing"
            ]
        },
        "Time": {
            "title": "Time",
            "description": "Model for ngen time configuraiton components\n    ",
            "type": "object",
            "properties": {
                "start_time": {
                    "title": "Start Time",
                    "type": "string",
                    "format": "date-time"
                },
                "end_time": {
                    "title": "End Time",
                    "type": "string",
                    "format": "date-time"
                },
                "output_interval": {
                    "title": "Output Interval",
                    "default": 3600,
                    "exclusiveMinimum": 0,
                    "type": "integer"
                }
            },
            "required": [
                "start_time",
                "end_time"
            ]
        },
        "Routing": {
            "title": "Routing",
            "description": "Model for ngen routing configuration information\n    ",
            "type": "object",
            "properties": {
                "t_route_config_file_with_path": {
                    "title": "T Route Config File With Path",
                    "format": "file-path",
                    "type": "string"
                },
                "t_route_connection_path": {
                    "title": "T Route Connection Path",
                    "default": "",
                    "type": "string"
                }
            },
            "required": [
                "t_route_config_file_with_path"
            ]
        },
        "CatchmentRealization": {
            "title": "CatchmentRealization",
            "description": "Simple model of a Realization, containing formulations and forcing\n    ",
            "type": "object",
            "properties": {
                "formulations": {
                    "title": "Formulations",
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/Formulation"
                    }
                },
                "forcing": {
                    "$ref": "#/definitions/Forcing"
                },
                "calibration": {
                    "title": "Calibration",
                    "type": "object",
                    "additionalProperties": {
                        "type": "array",
                        "items": {}
                    }
                }
            },
            "required": [
                "formulations"
            ]
        },
        "NgenRealization": {
            "title": "NgenRealization",
            "description": "A complete ngen realization confiiguration model, including global and catchment overrides\n    ",
            "type": "object",
            "properties": {
                "global": {
                    "$ref": "#/definitions/Realization"
                },
                "time": {
                    "$ref": "#/definitions/Time"
                },
                "catchments": {
                    "title": "Catchments",
                    "default": {},
                    "type": "object",
                    "additionalProperties": {
                        "$ref": "#/definitions/CatchmentRealization"
                    }
                }
            },
            "required": [
                "global",
                "time"
            ]
        },
        "Parameter": {
            "title": "Parameter",
            "description": "A parameter known to the model to estimate, defined by a name, minimum, maximum, and initial value",
            "type": "object",
            "properties": {
                "param": {
                    "title": "Param",
                    "type": "string"
                },
                "min": {
                    "title": "Min",
                    "type": "number"
                },
                "max": {
                    "title": "Max",
                    "type": "number"
                },
                "init": {
                    "title": "Init",
                    "type": "number"
                }
            },
            "required": [
                "param",
                "min",
                "max",
                "init"
            ]
        },
        "NgenIndependent": {
            "title": "NgenIndependent",
            "description": "Calibrate each catchment upstream of the observable nexus with its own permutated parameter space.",
            "type": "object",
            "properties": {
                "type": {
                    "title": "Type",
                    "const":"ngen"
                },
                "realization": {
                    "title": "Realization",
                    "format": "data-url",
                    "type": "string"
                },
                "hydrofabric": {
                    "title": "Hydrofabric",
                    "type": "string",
                    "readOnly": true
                },
                "strategy": {
                    "title": "Strategy",
                    "const":"independent"
                }
            },
            "required": [
                "type",
                "realization",
                "strategy"
            ]
        },
        "NgenExplicit": {
            "title": "NgenExplicit",
            "description": "Use the explicitly defined calibration information in the provided realization file.",
            "type": "object",
            "properties": {
                "type": {
                    "title": "Type",
                    "const":"ngen"
                },
                "realization": {
                    "title": "Realization",
                    "format": "data-url",
                    "type": "string"
                },
                "hydrofabric": {
                    "title": "Hydrofabric",
                    "type": "string",
                    "readOnly": true
                },
                "strategy": {
                    "title": "Strategy",
                    "const":"explicit"
                }
            },
            "required": [
                "type",
                "realization",
                "strategy"
            ]
        },
        "NgenUniform": {
            "title": "NgenUniform",
            "description": "Permute a global parameter space applied to each catchment upstream of the observable nexus.",
            "type": "object",
            "properties": {

                "type": {
                    "title": "Type",
                    "const":"ngen"
                },
                "realization": {
                    "title": "Realization",
                    "format": "data-url",
                    "type": "string"
                },
                "hydrofabric": {
                    "title": "Hydrofabric",
                    "type": "string",
                    "readOnly": true
                },
                "strategy": {
                    "title": "Strategy",
                    "const":"uniform"
                }
            },
            "required": [
                "type",
                "realization",
                "strategy"
            ]
        }
    }
}
